- name: infra-ec2-wait_for_linux_hosts
  hosts:
    - all:!windows
  become: true
  gather_facts: no
  roles:
  - { role: "infra-ec2-wait_for_linux_hosts" }

- import_playbook: ./solve_section2.yml
  when: solve == "true"

- name: Verify Section2
  hosts: apps
  gather_facts: True
  tasks:
  
  - name: Run a Curl Test against Frontend
    uri:
      url: http://{{ inventory_hostname }}
      return_content: yes
    register: webpage
    ignore_errors: yes

  - name: Verify section2
  hosts: apps
  gather_facts: no
  tasks:
  
 
  - name: Run a Curl Test against Frontend
    uri:
      url: http://{{ inventory_hostname }}
      return_content: yes
    register: webpage
    ignore_errors: yes
  - debug: var=webpage.content
 
  - name: set grade to fail
    set_fact:
      result: 
        - "{{ inventory_hostname }} : Fail" 
      reason: 
        - "{{inventory_hostname}} : Webpage is not having correct content"
    when:  ( webpage.status == -1 )  or ("'Example' not in webpage.content") or
           ( webpage.status == -1 )  or ("'has been customized using Ansible' not in webpage.content")
       

  - name: set grade to pass
    set_fact:
      result: 
        - "{{ inventory_hostname }} : PASS" 
      reason: 
        - "{{inventory_hostname}} : {{ webpage.content }}"
    when:  ("Example" in webpage.content) or
           ("has been customized using Ansible" in webpage.content)
    
  # - debug: var=reason
  # - debug: var=result

############## Play for Adding variable back to localhost ##############################
- name: append grade list from section1
  hosts: localhost
  roles:
  - role: adding_variable_to_localhost
    module: Lab03
    section: 02



 